{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/goals.css' %}">
    <title>Hello World</title>
</head>
<body>
    <!-- Main Header Section -->
    {% if user.is_authenticated %}
        <header>
            <h1>{{ user.first_name }}'s Goals</h1>
        </header>
        <form action="{% url 'index' %}">
            <button type="submit" class="home-button">Home</button>
        </form>
        <form action="{% url 'logout' %}">
            <button type="logout" class="logout-button">Log Out</button>
        </form>
        <div class="goals-home-view">
            {% for goal in goals %}
                <div class="home-view-goal">
                    <h2>{{ goal.name }}</h2>
                    <h3> You are {{ goal.completed }} for {{ goal.days }}</h3>
                    <form action="{% url 'goals' %}">
                        <button type="submit" class="goals-button">Calendar</button>
                    </form>
                    <form action="{% url 'goals' %}">
                        <button type="submit" class="goals-button">Log (Un)Successful</button>
                    </form>
                </div>
            {% endfor %}
        </div>
        
        <!-- Plus Button to Add New Goal -->
        <form action="{% url 'goals' %}" id="newGoalForm" method="post">
            {% csrf_token %}
            <button type="button" id="newGoalButton" class="new-goal-button">+</button>
            <div id="goalContainer"></div>
        </form>

        <!-- JavaScript to handle button click -->
        <script>
            let goalAdded = false;  // Flag to track if a goal input is already added
            
            document.getElementById("newGoalButton").onclick = function() {
                if (goalAdded) {
                    return; // Prevent adding another goal input until the current one is submitted
                }
                
                const goalContainer = document.getElementById("goalContainer");

                // Create input field for the goal
                const inputField = document.createElement("input");
                inputField.setAttribute("type", "text");
                inputField.setAttribute("placeholder", "Enter goal");
                inputField.classList.add("goal-input"); // Apply the class for styling
                inputField.required = true; // Make the input field required
                inputField.name = "goal";
                
                // Create frequency dropdown
                const frequencySelect = document.createElement("select");
                frequencySelect.name = "frequency";
                frequencySelect.classList.add("frequency-select");
                frequencySelect.required = true; // Make the select field required
                frequencySelect.setAttribute("placeholder", "Select frequency");
                frequencySelect.innerHTML = "<option value='' disabled selected>Select frequency</option>";
                frequencySelect.classList.add("frequency-select");
                frequencySelect.name = "frequency";
                const dailyOption = document.createElement("option");
                dailyOption.value = "daily";
                dailyOption.text = "Daily";
                const weeklyOption = document.createElement("option");
                weeklyOption.value = "weekly";
                weeklyOption.text = "Weekly";
                const monthlyOption = document.createElement("option");
                monthlyOption.value = "monthly";
                monthlyOption.text = "Monthly";
                frequencySelect.appendChild(dailyOption);
                frequencySelect.appendChild(weeklyOption);
                frequencySelect.appendChild(monthlyOption);

                // Create date picker input
                const dateInput = document.createElement("input");
                dateInput.setAttribute("type", "date");
                dateInput.classList.add("date-picker");
                dateInput.required = true; // Make the input field required
                dateInput.name = "date";

                // Create submit button for the goal
                const submitButton = document.createElement("button");
                submitButton.setAttribute("type", "submit");
                submitButton.classList.add("submit-button");
                submitButton.innerHTML = "Submit";

                // Append all elements to the container
                goalContainer.appendChild(inputField);
                goalContainer.appendChild(frequencySelect);
                goalContainer.appendChild(dateInput);
                goalContainer.appendChild(submitButton);

                // Disable the new goal button to prevent further input boxes from being added
                goalAdded = true;
                
                // Optionally, hide the "+" button to prevent more goals until the current is submitted
                document.getElementById("newGoalButton").disabled = true;
            };

            // Prevent the user from submitting the form unless all fields are filled
            document.getElementById("newGoalForm").onsubmit = function(event) {
                const goalInput = document.querySelector(".goal-input");
                const frequencySelect = document.querySelector(".frequency-select");
                const dateInput = document.querySelector(".date-picker");

                // Check if all fields are filled
                if (!goalInput.value || !frequencySelect.value || !dateInput.value) {
                    alert("Please fill out all fields before submitting.");
                    event.preventDefault(); // Prevent form submission
                }
            };
        </script>
    {% else %}
        <header>
            <h1>Goals</h1>
        </header>
        <form action="{% url 'login' %}">
            <button type="login" class="login-button">Log In</button>
        </form>
        <form action="{% url 'signup' %}">
            <button type="signup" class="signup-button">Sign Up</button>
        </form>
    {% endif %}
</body>
</html>
